---
id: agent-query-stream-api-v-1-rag-agent-query-stream-post
title: "Agent Query Stream"
description: "Stream a response to a query in a simple markdown format."
sidebar_label: "Agent Query Stream"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/captide-rest-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Agent Query Stream"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/v1/rag/agent-query-stream"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Stream a response to a query in a simple markdown format.

This endpoint provides a simplified streaming response:
1. First, it streams the ID mapping for source linking
2. Then it streams raw markdown content as it comes from the LLM

The client only needs to concatenate the markdown chunks to get the full document,
and can use the ID mapping to resolve citations to their sources.

Request body:
- **query**: The query to ask the agent (required)
- **tickers**: Optional list of ticker symbols to filter documents by
- **sourceType**: Optional source type(s) to include (available options: '10-K', '10-Q', '8-K', '20-F', '40-F', '6-K', 'transcript', 'DEF 14A', etc.).
                 Can be a single string or a list of strings.
- **startDate**: Optional start date for document filtering (format: YYYY-MM-DD)
- **endDate**: Optional end date for document filtering (format: YYYY-MM-DD)
- **sourceLink**: Optional source link(s) to search within. Can be a single string or a list of strings.
                 No other documents will be queried by the agent but these. Use to 
                 restrict the search to user-selected documents.

Returns a streaming response with these event types:
- 'id_mapping': A mapping of IDs to source links for citation resolution
  ```
  \{
    "type": "id_mapping",
    "mapping": \{
      "#uuid1234": \{
        "sourceLink": "http://rest-api.captide.co/document?id=12345678",
        "sourceMetadata": \{
          "sourceType": "10-K",
          "ticker": "AAPL",
          "date": "2024-01-01",
          "fiscalPeriod": "FY 2023",
          "documentId": "12345678"
        \}
      \}
    \}
  \}
  ```

- 'markdown_chunk': A chunk of markdown text
  ```
  \{
    "type": "markdown_chunk",
    "content": "This is a part of the markdown response with a citation [#uuid1234]."
  \}
  ```

- 'warning': Notification when requested information is not found
  ```
  \{
    "type": "warning",
    "message": "Could not find information about X in the provided documents."
  \}
  ```

- 'done': Signals the end of the stream
  ```
  \{
    "type": "done"
  \}
  ```

- 'error': Error information if something goes wrong
  ```
  \{
    "type": "error",
    "detail": "An error occurred while processing the request."
  \}
  ```

Client implementation recommendations:
1. First process the 'id_mapping' event to obtain source information for citations
2. Then accumulate all 'markdown_chunk' events to build the complete response
3. Display warnings to the user when 'warning' events are received
4. When a 'done' event is received, the response is complete
5. Use the ID mapping to create clickable citations in the rendered markdown

Integration with document search:
The 'sourceLink' parameter can be used in conjunction with the document search endpoint to:
1. Let users search and select specific documents they want to analyze
2. Then pass those document IDs to this endpoint to ensure the AI only references those selected documents
3. This creates a more user-controlled research experience where they can direct the AI to specific filings

*Note: All JSON fields use camelCase naming convention.*

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"properties":{"query":{"type":"string","title":"Query","description":"The query to ask the agent","example":"What are the key risks mentioned in the latest 10-K?"},"tickers":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tickers","description":"List of ticker symbols to filter documents by (e.g., ['AAPL', 'MSFT']). Check the '/companies' endpoint for available tickers.","example":["AAPL","MSFT"]},"sourceType":{"anyOf":[{"type":"string"},{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Sourcetype","description":"Source type(s) to include. Available options: 10-K, 10-Q, 8-K, 20-F, 40-F, 6-K, transcript, DEF 14A, DEFM14A, DEF 14C, DEFM14C. Can be a single string or a list of strings.","example":["10-K","10-Q"]},"start_date":{"anyOf":[{"type":"string","pattern":"^\\d{4}-\\d{2}-\\d{2}$"},{"type":"null"}],"title":"Start Date","description":"Start date for document filtering (format: YYYY-MM-DD)","example":"2022-01-01"},"end_date":{"anyOf":[{"type":"string","pattern":"^\\d{4}-\\d{2}-\\d{2}$"},{"type":"null"}],"title":"End Date","description":"End date for document filtering (format: YYYY-MM-DD)","example":"2023-12-31"},"sourceLink":{"anyOf":[{"type":"string"},{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Sourcelink","description":"Source link(s) to search within. No other documents will be queried by the agent but these. Can be a single string or a list of strings. Use to restrict the search to user-selected documents."}},"additionalProperties":true,"type":"object","required":["query"],"title":"AgentRequest","description":"Request schema for streaming RAG queries."}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"properties":{"detail":{"items":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"}}}}}}
>
  
</StatusCodes>


      